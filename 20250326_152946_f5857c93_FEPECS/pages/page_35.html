<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validação: ESP/DF em Andamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 20px; padding-bottom: 50px; }
        .validation-card { margin-bottom: 20px; }
        .error-details { 
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .navbar { position: fixed; bottom: 0; width: 100%; z-index: 100; }
        .approval-btn { margin-top: 15px; }
        .nav-bottom { 
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
            padding: 10px 0;
            z-index: 1000;
        }
        .page-container { margin-bottom: 60px; }
    </style>
</head>
<body>
    <div class="container page-container">

        <h1 class="mb-4">Detalhes da Validação</h1>
        <div class="card validation-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">ESP/DF em Andamento</h5>
                <span id="pageStatusBadge" class="badge bg-danger">Inválida</span>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>URL Original:</strong> 
                        <a href="https://www.fepecs.edu.br/espdf-em-andamento" target="_blank" class="btn btn-sm btn-outline-primary">https://www.fepecs.edu.br/espdf-em-andamento</a>
                    </div>
                    <div class="col-md-6">
                        <strong>URL Migrada:</strong> 
                        <a href="https://fepecs-hml.edu.br:8443/espdf-em-andamento" target="_blank" class="btn btn-sm btn-outline-primary">https://fepecs-hml.edu.br:8443/espdf-em-andamento</a>
                    </div>
                </div>
                
                <div class="mb-3">
                    <strong>Timestamp:</strong> 2025-03-25 23:05:02
                </div>
                
                <div class="mb-3">
                    <strong>Scores de Similaridade:</strong>
                    <ul class="list-group">
                        <li class="list-group-item">Conteúdo: 28%</li>
                        <li class="list-group-item">Estrutura: 32%</li>
                    </ul>
                </div>
                
                <h5 class="mt-4 mb-3">Erros Encontrados:</h5>
                <ul class="list-group">
<li class="list-group-item text-danger">Content Mismatch: Conteúdo principal não corresponde ao original (Similaridade: 28.00%):
Alterado de '30/07/24 às 10h37 - atualizado em 11/12/24 às 11h13 esp/df em andamento' para 'abertura de dispensa de licitacao – fornecimento de materiais de papelaria personalizados'
Alterado de 'ses' para 'fepecs'
Alterado de '48/2024, de 09 de dezembro de 2024 processo seletivo regular para preceptores de ensino dos programas de residência em área profissional da saúde – seleção 2025/1. edital nº 06, de 27 de novembro de 2024, processo seletivo para ingresso nos cursos de pós-graduação lato sensu, no período letivo de 2024/2025. edital esp nº 002, de 04 de setembro de 2024 – processo seletivo para formação de banco de projetos de pesquisa de candidatos ao programa de fomento à pesquisa da escola superior de ciências da saúde (escs/undf) e da escola de saúde pública do distrito federal (esp/df), mantidas pela fundação de ensino superior em ciências da saúde (fepecs) – seleção 2024 edital espdf nº 01/2024, de 20 de agosto de 2024 – credenciamento conjunto de atividades de extensão processo seletivo para seleção de trabalho da i mostra de estágios e práticas em saúde do distrito federal. processo seletivo de complementação da formação de auxiliar em saúde bucal para técnico em saúde bucal – seleção 2024 edital nº 05/2023 – curso de educação profissional de nível médio – técnico em análises clínicas – tac – seleção 2023 edital nº 18, de 23 de maio de 2024' para '06/2022'
Alterado de 'servidores da carreira magistério público da secretaria' para 'credenciamento'
Alterado de 'estado' para 'pessoas físicas para prestação'
Alterado de 'educação do distrito federal (seedf)' para 'serviços profissionais edital de licitação de pregão eletrônico n° 001/2023 – uasg 928075 – concessão de uso – lanchonete'</li><li class="list-group-item text-danger">HTML Structure Mismatch: Estrutura HTML divergente (Similaridade: 32.00% < 80.0%)</li><li class="list-group-item text-danger">Menu Mismatch: Menu não corresponde ao original:
Diferenças no menu:
Link 1: Texto diferente (Similaridade: 79.00%)
Original: 'ESP/DF em Andamento'
Migrado: 'Esp/df em Andamento'</li>
                </ul>
                
                <div class="approval-btn">
                    <button id="approveBtn" class="btn btn-success" onclick="approvePage('page_35')">
                        Aprovar Página
                    </button>
                    <button id="rejectBtn" class="btn btn-danger ms-2" onclick="rejectPage('page_35')">
                        Rejeitar Página
                    </button>
                    <div id="approvalStatus" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <a href="../index.html" class="btn btn-primary">Voltar para o Dashboard</a>
        </div>
    </div>
    
    <div class="nav-bottom">
        <div class="container">
            <div class="d-flex justify-content-between">
                <span class="text-muted">Validação de migração de páginas</span>
                <span class="text-muted">Gerado em: 26/03/2025 15:29:46</span>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variáveis de configuração
        const reportId = 'f5857c93';
        const pageId = 'page_35';
        
        // Função para buscar aprovações da API
        async function fetchApprovals() {
            try {
                const response = await fetch(`/api/approvals/${reportId}/${pageId}`);
                if (!response.ok) {
                    throw new Error('Erro ao buscar aprovações');
                }
                return await response.json();
            } catch (error) {
                console.error('Erro:', error);
                return {};
            }
        }
        
        // Função para enviar aprovação para a API
        async function sendApproval(status) {
            try {
                const response = await fetch(`/api/approvals/${reportId}/${pageId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        status: status,
                        user: 'validador'
                    }),
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao enviar aprovação');
                }
                
                return await response.json();
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao enviar aprovação. Tente novamente.');
                return null;
            }
        }
        
        // Gerenciamento de aprovação usando a API
        async function approvePage() {
            const result = await sendApproval('approved');
            if (result) {
                updateUI();
                alert("Página aprovada! Esta página aparecerá na seção de páginas aprovadas quando você voltar ao dashboard.");
            }
        }
        
        async function rejectPage() {
            const result = await sendApproval('rejected');
            if (result) {
                updateUI();
            }
        }
        
        async function updateUI() {
            const approval = await fetchApprovals();
            const status = document.getElementById('approvalStatus');
            const approveBtn = document.getElementById('approveBtn');
            const rejectBtn = document.getElementById('rejectBtn');
            const statusBadge = document.getElementById('pageStatusBadge');
            
            if (approval && approval.status) {
                if (approval.status === 'approved') {
                    status.innerHTML = '<div class="alert alert-success">Página aprovada!</div>';
                    statusBadge.textContent = 'Aprovada';
                    statusBadge.classList.remove('bg-danger');
                    statusBadge.classList.add('bg-success');
                    approveBtn.disabled = true;
                    rejectBtn.disabled = false;
                } else {
                    status.innerHTML = '<div class="alert alert-danger">Página rejeitada!</div>';
                    statusBadge.textContent = 'Rejeitada';
                    statusBadge.classList.remove('bg-success');
                    statusBadge.classList.add('bg-danger');
                    approveBtn.disabled = false;
                    rejectBtn.disabled = true;
                }
            } else {
                status.innerHTML = '';
                statusBadge.textContent = 'Inválida';
                statusBadge.classList.remove('bg-success');
                statusBadge.classList.add('bg-danger');
                approveBtn.disabled = false;
                rejectBtn.disabled = false;
            }
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', updateUI);
    </script>
</body>
</html>